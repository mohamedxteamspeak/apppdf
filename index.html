<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#6366f1">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <title>PDF Studio Pro v7.0</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <style>
        :root {
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --gradient-5: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-dark: linear-gradient(135deg, #0c0c1e 0%, #1a1a3e 50%, #0c0c1e 100%);
            
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #22d3ee;
            --accent: #f472b6;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            
            --bg-dark: #0a0a1a;
            --bg-card: rgba(255,255,255,0.03);
            --bg-card-hover: rgba(255,255,255,0.08);
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            
            --glow: 0 0 40px rgba(99, 102, 241, 0.3);
            --glow-strong: 0 0 60px rgba(99, 102, 241, 0.5);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
        }
        
        html, body {
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            overscroll-behavior: none;
        }
        
        /* Animated Background */
        .bg-animation {
            position: fixed;
            inset: 0;
            z-index: -1;
            overflow: hidden;
        }
        
        .bg-animation::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            top: -25%;
            left: -25%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(244, 114, 182, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(34, 211, 238, 0.1) 0%, transparent 40%);
            animation: bgFloat 20s ease-in-out infinite;
        }
        
        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(5deg); }
            66% { transform: translate(-20px, 20px) rotate(-5deg); }
        }
        
        /* Floating Orbs */
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.5;
            animation: orbFloat 15s ease-in-out infinite;
        }
        
        .orb-1 {
            width: 300px;
            height: 300px;
            background: var(--primary);
            top: -100px;
            right: -100px;
            animation-delay: 0s;
        }
        
        .orb-2 {
            width: 200px;
            height: 200px;
            background: var(--accent);
            bottom: 20%;
            left: -50px;
            animation-delay: -5s;
        }
        
        .orb-3 {
            width: 150px;
            height: 150px;
            background: var(--secondary);
            top: 40%;
            right: -50px;
            animation-delay: -10s;
        }
        
        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, 50px) scale(1.1); }
        }
        
        /* Page System */
        .page {
            display: none;
            min-height: 100vh;
            min-height: 100dvh;
            flex-direction: column;
            position: relative;
            animation: pageIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .page.active {
            display: flex;
        }
        
        @keyframes pageIn {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.98);
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1);
            }
        }
        
        /* Glass Morphism */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
        }
        
        .glass-strong {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        /* Buttons */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 18px 32px;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .btn:active::before {
            transform: translateX(100%);
        }
        
        .btn:active {
            transform: scale(0.96);
        }
        
        .btn-primary {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 10px 40px rgba(99, 102, 241, 0.4);
        }
        
        .btn-primary:active {
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: transparent;
            color: var(--primary-light);
            border: 2px solid rgba(99, 102, 241, 0.5);
        }
        
        .btn-secondary:active {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .btn-success {
            background: var(--gradient-4);
            color: #0a0a1a;
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
        }
        
        .btn-glass {
            background: rgba(255,255,255,0.1);
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .btn-icon {
            width: 52px;
            height: 52px;
            padding: 0;
            border-radius: 16px;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 24px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .card:active {
            transform: scale(0.98);
            background: var(--bg-card-hover);
        }
        
        .card.selected {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            box-shadow: var(--glow);
        }
        
        /* Hero Section */
        .hero-icon {
            width: 120px;
            height: 120px;
            border-radius: 40px;
            background: var(--gradient-1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            box-shadow: var(--glow-strong);
            position: relative;
        }
        
        .hero-icon::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 43px;
            background: var(--gradient-1);
            z-index: -1;
            opacity: 0.5;
            filter: blur(15px);
        }
        
        .hero-icon .material-icons-round {
            font-size: 60px;
            color: white;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 900;
            background: var(--gradient-3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        /* File Drop Zone */
        .drop-zone {
            border: 3px dashed rgba(99, 102, 241, 0.4);
            border-radius: 32px;
            padding: 48px 24px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .drop-zone::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-1);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .drop-zone:active::before,
        .drop-zone.dragover::before {
            opacity: 0.1;
        }
        
        .drop-zone:active,
        .drop-zone.dragover {
            border-color: var(--primary);
            transform: scale(0.99);
        }
        
        .drop-zone.processing {
            pointer-events: none;
            opacity: 0.6;
        }
        
        .drop-zone-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
            border-radius: 24px;
            background: rgba(99, 102, 241, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Image Gallery */
        .gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 12px;
            max-height: 50vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 16px;
            overflow: hidden;
            border: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .gallery-item.selected {
            border-color: var(--success);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }
        
        .gallery-item.excluded {
            opacity: 0.4;
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .gallery-item .badge {
            position: absolute;
            top: 6px;
            right: 6px;
            padding: 3px 8px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: 800;
        }
        
        .gallery-item .check {
            position: absolute;
            bottom: 6px;
            left: 6px;
            width: 26px;
            height: 26px;
            border-radius: 8px;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gallery-item.selected .check {
            background: var(--success);
        }
        
        .badge-dup { background: rgba(245, 158, 11, 0.9); color: #000; }
        .badge-logo { background: rgba(239, 68, 68, 0.9); color: #fff; }
        
        /* Filter Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .tabs::-webkit-scrollbar { display: none; }
        
        .tab {
            padding: 10px 18px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .tab.active {
            background: var(--gradient-1);
            color: white;
        }
        
        .tab:not(.active) {
            background: rgba(255,255,255,0.05);
            color: var(--text-muted);
        }
        
        /* Layout Grid */
        .layout-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .layout-item {
            aspect-ratio: 3/4;
            border-radius: 16px;
            background: rgba(255,255,255,0.03);
            border: 2px solid transparent;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
        }
        
        .layout-item.selected {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.15);
        }
        
        .layout-preview {
            flex: 1;
            display: grid;
            gap: 3px;
        }
        
        .layout-dot {
            background: rgba(99, 102, 241, 0.4);
            border-radius: 3px;
        }
        
        .layout-label {
            text-align: center;
            font-size: 0.8rem;
            font-weight: 700;
            margin-top: 6px;
            color: var(--text-muted);
        }
        
        .layout-item.selected .layout-label {
            color: var(--primary-light);
        }
        
        /* Progress Ring */
        .progress-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }
        
        .progress-ring {
            width: 200px;
            height: 200px;
            position: relative;
        }
        
        .progress-ring svg {
            transform: rotate(-90deg);
            filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.5));
        }
        
        .progress-ring circle {
            fill: none;
            stroke-width: 10;
        }
        
        .progress-ring .bg {
            stroke: rgba(255,255,255,0.1);
        }
        
        .progress-ring .bar {
            stroke: url(#progressGradient);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s ease;
        }
        
        .progress-text {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .progress-percent {
            font-size: 3rem;
            font-weight: 900;
        }
        
        .progress-label {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        /* Input */
        input[type="text"] {
            width: 100%;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 16px 20px;
            color: white;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s;
            -webkit-appearance: none;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            box-shadow: var(--glow);
        }
        
        /* Checkbox */
        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 16px;
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .checkbox-row:active {
            background: rgba(255,255,255,0.08);
        }
        
        .checkbox-box {
            width: 28px;
            height: 28px;
            border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .checkbox-row.checked .checkbox-box {
            background: var(--gradient-1);
            border-color: transparent;
        }
        
        /* Snackbar */
        .snackbar {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            z-index: 2000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 90%;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .snackbar.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* Loading */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 10, 26, 0.98);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            gap: 20px;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Image Viewer */
        .viewer {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 2500;
            display: none;
            flex-direction: column;
        }
        
        .viewer.show {
            display: flex;
        }
        
        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
        }
        
        .viewer-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        
        .viewer-content img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }
        
        .viewer-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
        }
        
        .viewer-nav.prev { left: 12px; }
        .viewer-nav.next { right: 12px; }
        
        /* Action Bar */
        .action-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            padding-bottom: max(16px, env(safe-area-inset-bottom));
            background: linear-gradient(to top, var(--bg-dark) 0%, var(--bg-dark) 80%, transparent 100%);
            display: flex;
            gap: 12px;
            z-index: 100;
        }
        
        /* Step Dots */
        .steps {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 20px;
        }
        
        .step {
            width: 8px;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s;
        }
        
        .step.active {
            background: var(--gradient-1);
            width: 28px;
        }
        
        .step.done {
            background: var(--success);
        }
        
        /* Debug Console */
        .console {
            background: rgba(0,0,0,0.8);
            border-radius: 12px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.7rem;
            color: #0f0;
            max-height: 120px;
            overflow-y: auto;
            margin-top: 12px;
            border: 1px solid rgba(0,255,0,0.2);
        }
        
        .console .error { color: #f55; }
        .console .warn { color: #fa0; }
        .console .info { color: #0af; }
        
        /* Header */
        .header {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-back {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            background: rgba(255,255,255,0.05);
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .header-title {
            flex: 1;
        }
        
        .header-title h2 {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .header-title p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
        
        /* Content spacing */
        .content {
            flex: 1;
            padding: 0 20px 120px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .section-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Confetti Animation */
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confetti 3s ease-out forwards;
        }
    </style>
</head>
<body>
    <!-- Background Animation -->
    <div class="bg-animation">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loader"></div>
        <p id="loadingText" class="text-lg">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>
        <div id="loadingBar" class="w-64 h-2 bg-white/10 rounded-full overflow-hidden" style="display: none;">
            <div id="loadingProgress" class="h-full rounded-full transition-all" style="width: 0%; background: var(--gradient-1);"></div>
        </div>
        <p id="loadingDetail" class="text-sm text-white/50"></p>
    </div>

    <!-- Image Viewer -->
    <div id="imageViewer" class="viewer">
        <div class="viewer-header">
            <button onclick="closeViewer()" class="btn btn-glass btn-icon">
                <span class="material-icons-round">close</span>
            </button>
            <span id="viewerCounter" class="font-medium">1/10</span>
            <button onclick="toggleViewerSelect()" id="viewerToggle" class="btn btn-icon" style="background: var(--success);">
                <span class="material-icons-round" id="viewerToggleIcon">check</span>
            </button>
        </div>
        <div class="viewer-content">
            <img id="viewerImage" src="" alt="">
        </div>
        <button class="viewer-nav prev" onclick="viewerPrev()">
            <span class="material-icons-round">chevron_right</span>
        </button>
        <button class="viewer-nav next" onclick="viewerNext()">
            <span class="material-icons-round">chevron_left</span>
        </button>
        <div class="p-4 text-center">
            <p id="viewerInfo" class="text-sm text-white/50"></p>
        </div>
    </div>

    <!-- Snackbar -->
    <div id="snackbar" class="snackbar">
        <span class="material-icons-round" id="snackbarIcon">info</span>
        <span id="snackbarText">ÿ±ÿ≥ÿßŸÑÿ©</span>
    </div>

    <!-- ========== PAGE: WELCOME ========== -->
    <div id="pageWelcome" class="page active">
        <div class="flex-1 flex flex-col items-center justify-center p-6">
            <div class="text-center mb-10">
                <div class="hero-icon">
                    <span class="material-icons-round">auto_fix_high</span>
                </div>
                <h1 class="text-3xl font-black mb-2">
                    <span style="background: var(--gradient-1); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">PDF Studio</span>
                </h1>
                <p class="text-lg text-white/60 mb-1">ŸÖÿ≠ŸàŸÑ ÿßŸÑÿµŸàÿ± ÿßŸÑÿ∞ŸÉŸä</p>
                <p class="text-sm text-white/40">ÿßŸÑÿ•ÿµÿØÿßÿ± 7.0 Pro</p>
            </div>
            
            <div class="w-full max-w-sm space-y-4">
                <button onclick="startPDF()" class="btn btn-primary w-full">
                    <span class="material-icons-round">picture_as_pdf</span>
                    ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ŸÖŸÜ PDF
                </button>
                <button onclick="startImages()" class="btn btn-secondary w-full">
                    <span class="material-icons-round">photo_library</span>
                    ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸàÿ±
                </button>
            </div>
            
            <div class="glass mt-10 p-5 max-w-sm w-full">
                <div class="flex gap-4">
                    <div class="w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0" style="background: var(--gradient-5);">
                        <span class="material-icons-round text-white">bolt</span>
                    </div>
                    <div>
                        <h3 class="font-bold mb-2">ŸÖŸÖŸäÿ≤ÿßÿ™ v7.0</h3>
                        <ul class="text-sm text-white/60 space-y-1">
                            <li>‚ö° ŸÖÿ≠ÿ±ŸÉ ÿ¨ÿØŸäÿØ ŸÉŸÑŸäÿßŸã</li>
                            <li>üî• ÿ≠ŸÑ ŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ©</li>
                            <li>üì± ŸÖÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ¨Ÿáÿ≤ÿ©</li>
                            <li>‚ú® ÿ™ÿµŸÖŸäŸÖ ÿπÿµÿ±Ÿä</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <p id="deviceInfo" class="text-xs text-white/30 mt-6"></p>
        </div>
        
        <div class="steps">
            <div class="step active"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
        </div>
    </div>

    <!-- ========== PAGE: FILE SELECT ========== -->
    <div id="pageFile" class="page">
        <div class="header" style="background: var(--gradient-1); border-radius: 0 0 32px 32px; padding-bottom: 32px;">
            <button class="header-back" onclick="goTo('Welcome')">
                <span class="material-icons-round">arrow_forward</span>
            </button>
            <div class="header-title">
                <h2 id="fileTitle">ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ PDF</h2>
                <p id="fileSubtitle">ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿµŸàÿ±</p>
            </div>
        </div>
        
        <div class="content" style="margin-top: -20px;">
            <div id="dropZone" class="drop-zone glass" onclick="triggerInput()">
                <div class="drop-zone-icon">
                    <span class="material-icons-round text-3xl" style="color: var(--primary-light);" id="dropIcon">cloud_upload</span>
                </div>
                <p class="font-bold text-lg mb-1" id="dropLabel">ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑÿßÿÆÿ™Ÿäÿßÿ±</p>
                <p class="text-sm text-white/50" id="dropHint">ÿ£Ÿà ÿßÿ≥ÿ≠ÿ® ÿßŸÑŸÖŸÑŸÅ ŸáŸÜÿß</p>
            </div>
            
            <input type="file" id="inputPDF" accept=".pdf,application/pdf" hidden>
            <input type="file" id="inputImages" accept="image/*" multiple hidden>
            
            <!-- Stats after file load -->
            <div id="statsSection" class="hidden mt-6">
                <div class="stats-grid mb-5">
                    <div class="stat-card">
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statValid">0</div>
                        <div class="stat-label">ÿµÿßŸÑÿ≠ÿ©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statFiltered">0</div>
                        <div class="stat-label">ŸÖÿ≥ÿ™ÿ®ÿπÿØÿ©</div>
                    </div>
                </div>
                
                <button onclick="goTo('Gallery')" class="btn btn-primary w-full">
                    <span class="material-icons-round">visibility</span>
                    ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿµŸàÿ±
                </button>
                
                <div id="debugConsole" class="console hidden"></div>
            </div>
        </div>
        
        <div class="steps">
            <div class="step done"></div>
            <div class="step active"></div>
            <div class="step"></div>
            <div class="step"></div>
        </div>
    </div>

    <!-- ========== PAGE: GALLERY ========== -->
    <div id="pageGallery" class="page">
        <div class="header" style="background: var(--gradient-1); border-radius: 0 0 32px 32px;">
            <button class="header-back" onclick="goTo('File')">
                <span class="material-icons-round">arrow_forward</span>
            </button>
            <div class="header-title">
                <h2>ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿµŸàÿ±</h2>
                <p><span id="selectedCount">0</span> ÿµŸàÿ±ÿ© ŸÖÿ≠ÿØÿØÿ©</p>
            </div>
        </div>
        
        <div class="tabs" style="margin-top: -16px;">
            <button class="tab active" data-f="all" onclick="filterBy('all')">ÿßŸÑŸÉŸÑ <span id="cAll">0</span></button>
            <button class="tab" data-f="valid" onclick="filterBy('valid')">ÿµÿßŸÑÿ≠ÿ© <span id="cValid">0</span></button>
            <button class="tab" data-f="dup" onclick="filterBy('dup')">ŸÖŸÉÿ±ÿ±ÿ© <span id="cDup">0</span></button>
            <button class="tab" data-f="logo" onclick="filterBy('logo')">ÿ¥ÿπÿßÿ±ÿßÿ™ <span id="cLogo">0</span></button>
        </div>
        
        <div class="flex-1 overflow-auto">
            <div id="gallery" class="gallery"></div>
            <div id="emptyGallery" class="hidden text-center py-16 text-white/40">
                <span class="material-icons-round text-5xl mb-3">image_not_supported</span>
                <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿµŸàÿ±</p>
            </div>
        </div>
        
        <div class="action-bar">
            <button onclick="selectAll()" class="btn btn-glass flex-1">
                <span class="material-icons-round">select_all</span>
                ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ
            </button>
            <button onclick="goTo('Layout')" class="btn btn-primary flex-1">
                ÿßŸÑÿ™ÿßŸÑŸä
                <span class="material-icons-round">arrow_back</span>
            </button>
        </div>
        
        <div class="steps" style="margin-bottom: 80px;">
            <div class="step done"></div>
            <div class="step done"></div>
            <div class="step active"></div>
            <div class="step"></div>
        </div>
    </div>

    <!-- ========== PAGE: LAYOUT & SETTINGS ========== -->
    <div id="pageLayout" class="page">
        <div class="header" style="background: var(--gradient-1); border-radius: 0 0 32px 32px; padding-bottom: 32px;">
            <button class="header-back" onclick="goTo('Gallery')">
                <span class="material-icons-round">arrow_forward</span>
            </button>
            <div class="header-title">
                <h2>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</h2>
                <p>ÿßÿÆÿ™ÿ± ÿßŸÑÿ™ÿÆÿ∑Ÿäÿ∑ ŸàÿßŸÑÿßÿ≥ŸÖ</p>
            </div>
        </div>
        
        <div class="content" style="margin-top: -20px;">
            <p class="section-title">
                <span class="material-icons-round text-sm">grid_view</span>
                ÿµŸàÿ± ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ©
            </p>
            <div class="layout-grid mb-6" id="layoutGrid"></div>
            
            <div class="card mb-5">
                <div class="flex justify-between items-center">
                    <span class="text-white/60">ÿπÿØÿØ ÿßŸÑÿµŸÅÿ≠ÿßÿ™</span>
                    <span class="text-3xl font-black" style="background: var(--gradient-3); -webkit-background-clip: text; -webkit-text-fill-color: transparent;" id="pagesCount">0</span>
                </div>
            </div>
            
            <p class="section-title">
                <span class="material-icons-round text-sm">edit</span>
                ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÑŸÅ
            </p>
            <input type="text" id="fileName" placeholder="lesson_images" class="mb-5">
            
            <div class="checkbox-row checked" id="autoDownload" onclick="toggleAuto()">
                <div class="checkbox-box">
                    <span class="material-icons-round text-white text-sm">check</span>
                </div>
                <span>ÿ™ÿ≠ŸÖŸäŸÑ ÿ™ŸÑŸÇÿßÿ¶Ÿä</span>
            </div>
            
            <div class="card mt-5">
                <p class="section-title mb-3">
                    <span class="material-icons-round text-sm">summarize</span>
                    ŸÖŸÑÿÆÿµ
                </p>
                <div class="flex justify-between text-sm mb-2">
                    <span class="text-white/50">ÿµŸàÿ± ŸÖÿ≠ÿØÿØÿ©</span>
                    <span class="font-bold text-green-400" id="sumSelected">0</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-white/50">ŸÖÿ≥ÿ™ÿ®ÿπÿØÿ©</span>
                    <span class="font-bold text-white/40" id="sumExcluded">0</span>
                </div>
            </div>
        </div>
        
        <div class="action-bar">
            <button onclick="createPDF()" class="btn btn-success flex-1" id="createBtn">
                <span class="material-icons-round">auto_awesome</span>
                ÿ•ŸÜÿ¥ÿßÿ° PDF
            </button>
        </div>
        
        <div class="steps" style="margin-bottom: 80px;">
            <div class="step done"></div>
            <div class="step done"></div>
            <div class="step done"></div>
            <div class="step active"></div>
        </div>
    </div>

    <!-- ========== PAGE: PROCESSING ========== -->
    <div id="pageProcessing" class="page">
        <div class="flex-1 flex flex-col items-center justify-center p-6">
            <div class="progress-container">
                <div class="progress-ring">
                    <svg width="200" height="200">
                        <defs>
                            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#667eea"/>
                                <stop offset="50%" stop-color="#764ba2"/>
                                <stop offset="100%" stop-color="#f093fb"/>
                            </linearGradient>
                        </defs>
                        <circle class="bg" cx="100" cy="100" r="90"/>
                        <circle class="bar" cx="100" cy="100" r="90" 
                                stroke-dasharray="565.48" 
                                stroke-dashoffset="565.48"
                                id="progressCircle"/>
                    </svg>
                    <div class="progress-text">
                        <span class="progress-percent" id="progressPercent">0%</span>
                        <span class="progress-label" id="progressLabel">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°</span>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid w-full max-w-xs mt-8">
                <div class="stat-card">
                    <div class="stat-value" id="procImages">0</div>
                    <div class="stat-label">ÿµŸàÿ±ÿ©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="procPages">0</div>
                    <div class="stat-label">ÿµŸÅÿ≠ÿ©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="procErrors">0</div>
                    <div class="stat-label">ÿ£ÿÆÿ∑ÿßÿ°</div>
                </div>
            </div>
            
            <div id="procConsole" class="console w-full max-w-xs mt-6"></div>
        </div>
    </div>

    <!-- ========== PAGE: RESULT ========== -->
    <div id="pageResult" class="page">
        <div class="flex-1 flex flex-col items-center justify-center p-6">
            <div class="text-center mb-8">
                <div class="hero-icon mb-6" style="background: var(--gradient-4);">
                    <span class="material-icons-round">task_alt</span>
                </div>
                <h1 class="text-2xl font-black mb-2">ÿ™ŸÖ ÿ®ŸÜÿ¨ÿßÿ≠! üéâ</h1>
                <p class="text-white/60">ŸÖŸÑŸÅ PDF ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ™ÿ≠ŸÖŸäŸÑ</p>
            </div>
            
            <div class="stats-grid w-full max-w-xs mb-8">
                <div class="stat-card">
                    <div class="stat-value" id="resImages">0</div>
                    <div class="stat-label">ÿµŸàÿ±ÿ©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="resPages">0</div>
                    <div class="stat-label">ÿµŸÅÿ≠ÿ©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="resSize">0</div>
                    <div class="stat-label">ÿ≠ÿ¨ŸÖ MB</div>
                </div>
            </div>
            
            <div class="w-full max-w-sm space-y-3">
                <button onclick="downloadResult()" class="btn btn-primary w-full">
                    <span class="material-icons-round">download</span>
                    ÿ™ÿ≠ŸÖŸäŸÑ PDF
                </button>
                
                <button onclick="shareResult()" class="btn btn-secondary w-full">
                    <span class="material-icons-round">share</span>
                    ŸÖÿ¥ÿßÿ±ŸÉÿ©
                </button>
                
                <button onclick="previewResult()" class="btn btn-glass w-full">
                    <span class="material-icons-round">visibility</span>
                    ŸÖÿπÿßŸäŸÜÿ©
                </button>
                
                <button onclick="startOver()" class="btn btn-glass w-full">
                    <span class="material-icons-round">refresh</span>
                    ÿ®ÿØÿ° ÿ¨ÿØŸäÿØ
                </button>
            </div>
            
            <p class="text-xs text-white/30 mt-10">PDF Studio v7.0 ‚Ä¢ Mohamed Elherd</p>
        </div>
    </div>

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // ============================================================
        // CONFIGURATION
        // ============================================================
        const CONFIG = {
            MAX_IMG_SIZE: 500, // Smaller for reliability
            JPEG_QUALITY: 0.6, // Lower for smaller files
            MIN_SIZE: 50,
            LOGO_MAX_SIZE: 30000,
            HASH_SIZE: 8,
            LAYOUTS: {
                2: { cols: 1, rows: 2 },
                4: { cols: 2, rows: 2 },
                6: { cols: 2, rows: 3 },
                9: { cols: 3, rows: 3 },
                12: { cols: 3, rows: 4 },
                16: { cols: 4, rows: 4 }
            }
        };

        // Device detection
        const IS_MOBILE = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        const IS_WEBVIEW = /(wv|WebView)/i.test(navigator.userAgent) || window.navigator.standalone;

        // ============================================================
        // STATE
        // ============================================================
        const state = {
            mode: 'pdf',
            images: [],
            selected: new Set(),
            categories: { valid: [], dup: [], logo: [] },
            layout: 6,
            autoDownload: true,
            filter: 'all',
            viewerIdx: 0,
            viewerList: [],
            pdfBlob: null,
            fileName: 'lesson_images'
        };

        // ============================================================
        // CONSOLE LOGGING
        // ============================================================
        const logs = [];
        function log(msg, type = 'info') {
            const entry = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logs.push({ msg: entry, type });
            console.log(entry);
            
            // Update visible consoles
            ['debugConsole', 'procConsole'].forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.innerHTML = logs.slice(-15).map(l => 
                        `<div class="${l.type}">${l.msg}</div>`
                    ).join('');
                    el.scrollTop = el.scrollHeight;
                }
            });
        }

        // ============================================================
        // INIT
        // ============================================================
        document.addEventListener('DOMContentLoaded', () => {
            // PDF.js worker
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            
            // Setup file inputs
            document.getElementById('inputPDF').addEventListener('change', handlePDF);
            document.getElementById('inputImages').addEventListener('change', handleImages);
            
            // Build layout grid
            buildLayoutGrid();
            
            // Device info
            const info = `${IS_MOBILE ? 'üì±' : 'üíª'} ${IS_WEBVIEW ? 'WebView' : 'Browser'}`;
            document.getElementById('deviceInfo').textContent = info;
            log(`Initialized: ${info}`);
        });

        // ============================================================
        // NAVIGATION
        // ============================================================
        function goTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page${page}`).classList.add('active');
            
            if (page === 'Gallery') {
                renderGallery();
                updateCounts();
            } else if (page === 'Layout') {
                updateLayoutInfo();
            }
        }

        function startPDF() {
            state.mode = 'pdf';
            document.getElementById('fileTitle').textContent = 'ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ PDF';
            document.getElementById('fileSubtitle').textContent = 'ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿµŸàÿ±';
            document.getElementById('dropIcon').textContent = 'picture_as_pdf';
            resetState();
            goTo('File');
        }

        function startImages() {
            state.mode = 'images';
            document.getElementById('fileTitle').textContent = 'ÿßÿÆÿ™ÿ± ÿßŸÑÿµŸàÿ±';
            document.getElementById('fileSubtitle').textContent = 'ÿµŸàÿ± ŸÖÿ™ÿπÿØÿØÿ©';
            document.getElementById('dropIcon').textContent = 'photo_library';
            resetState();
            goTo('File');
        }

        function resetState() {
            state.images = [];
            state.selected = new Set();
            state.categories = { valid: [], dup: [], logo: [] };
            state.pdfBlob = null;
            document.getElementById('statsSection').classList.add('hidden');
            document.getElementById('dropLabel').textContent = 'ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑÿßÿÆÿ™Ÿäÿßÿ±';
            document.getElementById('dropHint').textContent = 'ÿ£Ÿà ÿßÿ≥ÿ≠ÿ® ÿßŸÑŸÖŸÑŸÅ ŸáŸÜÿß';
            logs.length = 0;
        }

        // ============================================================
        // FILE HANDLING
        // ============================================================
        function triggerInput() {
            document.getElementById(state.mode === 'pdf' ? 'inputPDF' : 'inputImages').click();
        }

        async function handlePDF(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            state.fileName = file.name.replace('.pdf', '') + '_images';
            document.getElementById('dropLabel').textContent = file.name;
            document.getElementById('dropHint').textContent = formatSize(file.size);
            document.getElementById('dropZone').classList.add('processing');
            document.getElementById('debugConsole').classList.remove('hidden');
            
            showLoading('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨...');
            log(`Opening: ${file.name}`);
            
            try {
                // Try embedded images first
                let images = await extractEmbedded(file);
                
                // Fallback to page rendering
                if (images.length === 0) {
                    log('No embedded images, rendering pages...', 'warn');
                    updateLoading('ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿßÿ™...');
                    images = await renderPages(file);
                }
                
                if (images.length === 0) {
                    throw new Error('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿµŸàÿ±');
                }
                
                state.images = images;
                log(`Extracted: ${images.length} images`);
                
                updateLoading('ÿ™ÿ≠ŸÑŸäŸÑ...');
                await analyzeImages();
                
                hideLoading();
                showStats();
                document.getElementById('dropZone').classList.remove('processing');
                document.getElementById('fileName').value = state.fileName;
                
            } catch (err) {
                log(`Error: ${err.message}`, 'error');
                hideLoading();
                toast(err.message, 'error');
                document.getElementById('dropZone').classList.remove('processing');
            }
        }

        async function handleImages(e) {
            const files = [...e.target.files].filter(f => f.type.startsWith('image/'));
            if (!files.length) return;
            
            files.sort((a, b) => a.name.localeCompare(b.name, 'ar', { numeric: true }));
            
            state.fileName = 'images';
            document.getElementById('dropLabel').textContent = `${files.length} ÿµŸàÿ±ÿ©`;
            document.getElementById('dropZone').classList.add('processing');
            document.getElementById('debugConsole').classList.remove('hidden');
            
            showLoading('ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±...');
            showLoadingBar(true);
            log(`Loading ${files.length} images`);
            
            try {
                state.images = [];
                
                for (let i = 0; i < files.length; i++) {
                    updateLoading(`${i + 1}/${files.length}`);
                    updateLoadingBar((i / files.length) * 100);
                    
                    const data = await fileToDataURL(files[i]);
                    const compressed = await compressImage(data);
                    
                    state.images.push({
                        id: i,
                        data: compressed.data,
                        w: compressed.w,
                        h: compressed.h,
                        name: files[i].name,
                        cat: 'valid'
                    });
                    
                    if (i % 3 === 0) await delay(5);
                }
                
                log(`Loaded: ${state.images.length} images`);
                updateLoading('ÿ™ÿ≠ŸÑŸäŸÑ...');
                await analyzeImages();
                
                hideLoading();
                showStats();
                document.getElementById('dropZone').classList.remove('processing');
                document.getElementById('fileName').value = state.fileName;
                
            } catch (err) {
                log(`Error: ${err.message}`, 'error');
                hideLoading();
                toast('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ', 'error');
                document.getElementById('dropZone').classList.remove('processing');
            }
        }

        // ============================================================
        // PDF EXTRACTION - EMBEDDED IMAGES
        // ============================================================
        async function extractEmbedded(file) {
            const buffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
            const images = [];
            let counter = 0;
            
            log(`PDF has ${pdf.numPages} pages`);
            showLoadingBar(true);
            
            for (let p = 1; p <= pdf.numPages; p++) {
                try {
                    updateLoading(`ÿµŸÅÿ≠ÿ© ${p}/${pdf.numPages}`);
                    updateLoadingBar((p / pdf.numPages) * 100);
                    
                    const page = await pdf.getPage(p);
                    const ops = await page.getOperatorList();
                    
                    // Find image references
                    const refs = new Set();
                    for (let i = 0; i < ops.fnArray.length; i++) {
                        if ([82, 83, 85].includes(ops.fnArray[i])) {
                            const name = ops.argsArray[i][0];
                            if (name) refs.add(name);
                        }
                    }
                    
                    log(`Page ${p}: ${refs.size} images`);
                    
                    for (const ref of refs) {
                        try {
                            const obj = await Promise.race([
                                new Promise((res, rej) => {
                                    page.objs.get(ref, img => img ? res(img) : rej());
                                }),
                                delay(2000).then(() => { throw new Error('timeout'); })
                            ]);
                            
                            if (obj && obj.width > 30 && obj.height > 30) {
                                const dataUrl = await imageObjToJPEG(obj);
                                if (dataUrl) {
                                    const comp = await compressImage(dataUrl);
                                    images.push({
                                        id: counter++,
                                        data: comp.data,
                                        w: comp.w,
                                        h: comp.h,
                                        name: `p${p}_${counter}.jpg`,
                                        cat: 'valid'
                                    });
                                }
                            }
                        } catch (e) { /* skip */ }
                    }
                    
                    page.cleanup();
                    await delay(10);
                    
                } catch (e) {
                    log(`Page ${p} error`, 'error');
                }
            }
            
            showLoadingBar(false);
            return images;
        }

        async function imageObjToJPEG(obj) {
            try {
                const maxSize = CONFIG.MAX_IMG_SIZE;
                let w = Math.min(obj.width, maxSize);
                let h = Math.min(obj.height, maxSize);
                
                if (obj.width > maxSize || obj.height > maxSize) {
                    const ratio = Math.min(maxSize / obj.width, maxSize / obj.height);
                    w = Math.round(obj.width * ratio);
                    h = Math.round(obj.height * ratio);
                }
                
                const canvas = document.createElement('canvas');
                canvas.width = w;
                canvas.height = h;
                const ctx = canvas.getContext('2d');
                
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, w, h);
                
                if (obj.bitmap) {
                    ctx.drawImage(obj.bitmap, 0, 0, w, h);
                } else if (obj.data) {
                    const temp = document.createElement('canvas');
                    temp.width = obj.width;
                    temp.height = obj.height;
                    const tctx = temp.getContext('2d');
                    
                    const imgData = tctx.createImageData(obj.width, obj.height);
                    const src = obj.data;
                    const dst = imgData.data;
                    const pixels = obj.width * obj.height;
                    
                    if (src.length === pixels * 4) {
                        dst.set(src);
                    } else if (src.length === pixels * 3) {
                        for (let i = 0; i < pixels; i++) {
                            dst[i*4] = src[i*3];
                            dst[i*4+1] = src[i*3+1];
                            dst[i*4+2] = src[i*3+2];
                            dst[i*4+3] = 255;
                        }
                    } else if (src.length === pixels) {
                        for (let i = 0; i < pixels; i++) {
                            dst[i*4] = dst[i*4+1] = dst[i*4+2] = src[i];
                            dst[i*4+3] = 255;
                        }
                    } else {
                        return null;
                    }
                    
                    tctx.putImageData(imgData, 0, 0);
                    ctx.drawImage(temp, 0, 0, w, h);
                    temp.width = temp.height = 0;
                } else {
                    return null;
                }
                
                const result = canvas.toDataURL('image/jpeg', CONFIG.JPEG_QUALITY);
                canvas.width = canvas.height = 0;
                return result;
                
            } catch (e) {
                return null;
            }
        }

        // ============================================================
        // PDF EXTRACTION - RENDER PAGES
        // ============================================================
        async function renderPages(file) {
            const buffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
            const images = [];
            
            showLoadingBar(true);
            const scale = IS_MOBILE ? 1.0 : 1.3;
            
            for (let p = 1; p <= pdf.numPages; p++) {
                try {
                    updateLoading(`ÿ™ÿ≠ŸàŸäŸÑ ${p}/${pdf.numPages}`);
                    updateLoadingBar((p / pdf.numPages) * 100);
                    
                    const page = await pdf.getPage(p);
                    let vp = page.getViewport({ scale });
                    
                    // Limit size
                    const maxDim = IS_MOBILE ? 600 : 900;
                    if (vp.width > maxDim || vp.height > maxDim) {
                        const ratio = Math.min(maxDim / vp.width, maxDim / vp.height);
                        vp = page.getViewport({ scale: scale * ratio });
                    }
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = vp.width;
                    canvas.height = vp.height;
                    const ctx = canvas.getContext('2d');
                    
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    await page.render({ canvasContext: ctx, viewport: vp }).promise;
                    
                    const dataUrl = canvas.toDataURL('image/jpeg', CONFIG.JPEG_QUALITY);
                    
                    images.push({
                        id: p - 1,
                        data: dataUrl,
                        w: canvas.width,
                        h: canvas.height,
                        name: `page_${p}.jpg`,
                        cat: 'valid'
                    });
                    
                    log(`Rendered page ${p}`);
                    
                    page.cleanup();
                    canvas.width = canvas.height = 0;
                    await delay(20);
                    
                } catch (e) {
                    log(`Page ${p} failed`, 'error');
                }
            }
            
            showLoadingBar(false);
            return images;
        }

        // ============================================================
        // IMAGE COMPRESSION
        // ============================================================
        async function compressImage(dataUrl) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => {
                    let w = img.width;
                    let h = img.height;
                    const max = CONFIG.MAX_IMG_SIZE;
                    
                    if (w > max || h > max) {
                        const ratio = Math.min(max / w, max / h);
                        w = Math.round(w * ratio);
                        h = Math.round(h * ratio);
                    }
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = w;
                    canvas.height = h;
                    const ctx = canvas.getContext('2d');
                    
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, w, h);
                    ctx.drawImage(img, 0, 0, w, h);
                    
                    const data = canvas.toDataURL('image/jpeg', CONFIG.JPEG_QUALITY);
                    canvas.width = canvas.height = 0;
                    
                    resolve({ data, w, h });
                };
                img.onerror = () => resolve({ data: dataUrl, w: 100, h: 100 });
                img.src = dataUrl;
            });
        }

        // ============================================================
        // IMAGE ANALYSIS
        // ============================================================
        async function analyzeImages() {
            state.categories = { valid: [], dup: [], logo: [] };
            state.selected = new Set();
            
            const hashes = new Map();
            
            for (const img of state.images) {
                // Check if logo
                if (img.w < CONFIG.MIN_SIZE || img.h < CONFIG.MIN_SIZE) {
                    img.cat = 'logo';
                    state.categories.logo.push(img.id);
                    continue;
                }
                
                // Get hash
                const hash = await getHash(img.data);
                
                // Check duplicate
                let isDup = false;
                for (const [h, id] of hashes) {
                    if (similarity(hash, h) > 0.9) {
                        isDup = true;
                        break;
                    }
                }
                
                if (isDup) {
                    img.cat = 'dup';
                    state.categories.dup.push(img.id);
                } else {
                    hashes.set(hash, img.id);
                    img.cat = 'valid';
                    state.categories.valid.push(img.id);
                    state.selected.add(img.id);
                }
            }
            
            log(`Valid: ${state.categories.valid.length}, Dup: ${state.categories.dup.length}, Logo: ${state.categories.logo.length}`);
        }

        async function getHash(dataUrl) {
            return new Promise(resolve => {
                const img = new Image();
                img.onload = () => {
                    const size = CONFIG.HASH_SIZE;
                    const canvas = document.createElement('canvas');
                    canvas.width = canvas.height = size;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, size, size);
                    
                    const data = ctx.getImageData(0, 0, size, size).data;
                    let hash = '';
                    let sum = 0;
                    const grays = [];
                    
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = (data[i] + data[i+1] + data[i+2]) / 3;
                        grays.push(gray);
                        sum += gray;
                    }
                    
                    const avg = sum / grays.length;
                    grays.forEach(g => hash += g > avg ? '1' : '0');
                    
                    canvas.width = canvas.height = 0;
                    resolve(hash);
                };
                img.onerror = () => resolve(Math.random().toString(36));
                img.src = dataUrl;
            });
        }

        function similarity(a, b) {
            if (a.length !== b.length) return 0;
            let match = 0;
            for (let i = 0; i < a.length; i++) {
                if (a[i] === b[i]) match++;
            }
            return match / a.length;
        }

        // ============================================================
        // STATS & GALLERY
        // ============================================================
        function showStats() {
            document.getElementById('statTotal').textContent = state.images.length;
            document.getElementById('statValid').textContent = state.categories.valid.length;
            document.getElementById('statFiltered').textContent = state.categories.dup.length + state.categories.logo.length;
            document.getElementById('statsSection').classList.remove('hidden');
            
            toast(`${state.images.length} ÿµŸàÿ±ÿ©ÿå ${state.categories.valid.length} ÿµÿßŸÑÿ≠ÿ©`, 'success');
        }

        function updateCounts() {
            document.getElementById('cAll').textContent = state.images.length;
            document.getElementById('cValid').textContent = state.categories.valid.length;
            document.getElementById('cDup').textContent = state.categories.dup.length;
            document.getElementById('cLogo').textContent = state.categories.logo.length;
            document.getElementById('selectedCount').textContent = state.selected.size;
        }

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            const filter = state.filter;
            
            let list = state.images;
            if (filter !== 'all') {
                const ids = state.categories[filter] || [];
                list = state.images.filter(img => ids.includes(img.id));
            }
            
            updateCounts();
            
            if (!list.length) {
                gallery.innerHTML = '';
                document.getElementById('emptyGallery').classList.remove('hidden');
                return;
            }
            
            document.getElementById('emptyGallery').classList.add('hidden');
            
            gallery.innerHTML = list.map((img, idx) => `
                <div class="gallery-item ${state.selected.has(img.id) ? 'selected' : 'excluded'}" 
                     data-id="${img.id}" data-idx="${idx}"
                     onclick="toggleSelect(${img.id})">
                    <img src="${img.data}" loading="lazy">
                    ${img.cat === 'dup' ? '<span class="badge badge-dup">ŸÖŸÉÿ±ÿ±</span>' : ''}
                    ${img.cat === 'logo' ? '<span class="badge badge-logo">ÿ¥ÿπÿßÿ±</span>' : ''}
                    <div class="check">
                        <span class="material-icons-round text-white text-xs">${state.selected.has(img.id) ? 'check' : ''}</span>
                    </div>
                </div>
            `).join('');
            
            // Long press for viewer
            gallery.querySelectorAll('.gallery-item').forEach(el => {
                let timer;
                el.addEventListener('touchstart', () => {
                    timer = setTimeout(() => openViewer(parseInt(el.dataset.idx)), 400);
                }, { passive: true });
                el.addEventListener('touchend', () => clearTimeout(timer));
                el.addEventListener('touchmove', () => clearTimeout(timer));
            });
        }

        function filterBy(f) {
            state.filter = f;
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.dataset.f === f);
            });
            renderGallery();
        }

        function toggleSelect(id) {
            if (state.selected.has(id)) {
                state.selected.delete(id);
            } else {
                state.selected.add(id);
            }
            renderGallery();
        }

        function selectAll() {
            const filter = state.filter;
            const ids = filter === 'all' ? state.images.map(i => i.id) : (state.categories[filter] || []);
            const allSel = ids.every(id => state.selected.has(id));
            
            ids.forEach(id => allSel ? state.selected.delete(id) : state.selected.add(id));
            renderGallery();
        }

        // ============================================================
        // IMAGE VIEWER
        // ============================================================
        function openViewer(idx) {
            const filter = state.filter;
            state.viewerList = filter === 'all' ? state.images : 
                state.images.filter(img => (state.categories[filter] || []).includes(img.id));
            
            if (idx < 0 || idx >= state.viewerList.length) return;
            state.viewerIdx = idx;
            updateViewer();
            document.getElementById('imageViewer').classList.add('show');
        }

        function updateViewer() {
            const img = state.viewerList[state.viewerIdx];
            document.getElementById('viewerImage').src = img.data;
            document.getElementById('viewerCounter').textContent = `${state.viewerIdx + 1}/${state.viewerList.length}`;
            document.getElementById('viewerInfo').textContent = `${img.w}√ó${img.h}`;
            
            const sel = state.selected.has(img.id);
            document.getElementById('viewerToggle').style.background = sel ? 'var(--success)' : 'var(--error)';
            document.getElementById('viewerToggleIcon').textContent = sel ? 'check' : 'close';
        }

        function closeViewer() {
            document.getElementById('imageViewer').classList.remove('show');
            renderGallery();
        }

        function viewerPrev() { if (state.viewerIdx > 0) { state.viewerIdx--; updateViewer(); } }
        function viewerNext() { if (state.viewerIdx < state.viewerList.length - 1) { state.viewerIdx++; updateViewer(); } }
        
        function toggleViewerSelect() {
            toggleSelect(state.viewerList[state.viewerIdx].id);
            updateViewer();
        }

        // Swipe
        let touchX = 0;
        document.getElementById('imageViewer').addEventListener('touchstart', e => touchX = e.touches[0].clientX, { passive: true });
        document.getElementById('imageViewer').addEventListener('touchend', e => {
            const diff = touchX - e.changedTouches[0].clientX;
            if (Math.abs(diff) > 50) diff > 0 ? viewerNext() : viewerPrev();
        });

        // ============================================================
        // LAYOUT
        // ============================================================
        function buildLayoutGrid() {
            const grid = document.getElementById('layoutGrid');
            grid.innerHTML = Object.entries(CONFIG.LAYOUTS).map(([n, l]) => `
                <div class="layout-item ${parseInt(n) === state.layout ? 'selected' : ''}" 
                     data-n="${n}" onclick="setLayout(${n})">
                    <div class="layout-preview" style="grid-template-columns: repeat(${l.cols}, 1fr);">
                        ${Array(Math.min(parseInt(n), 9)).fill('<div class="layout-dot"></div>').join('')}
                    </div>
                    <div class="layout-label">${n}</div>
                </div>
            `).join('');
        }

        function setLayout(n) {
            state.layout = n;
            document.querySelectorAll('.layout-item').forEach(el => {
                el.classList.toggle('selected', parseInt(el.dataset.n) === n);
            });
            updateLayoutInfo();
        }

        function updateLayoutInfo() {
            const l = CONFIG.LAYOUTS[state.layout];
            const pages = Math.ceil(state.selected.size / (l.cols * l.rows));
            
            document.getElementById('pagesCount').textContent = pages;
            document.getElementById('sumSelected').textContent = state.selected.size;
            document.getElementById('sumExcluded').textContent = state.images.length - state.selected.size;
        }

        function toggleAuto() {
            state.autoDownload = !state.autoDownload;
            document.getElementById('autoDownload').classList.toggle('checked', state.autoDownload);
        }

        // ============================================================
        // PDF CREATION - THE CRITICAL PART
        // ============================================================
        async function createPDF() {
            if (!state.selected.size) {
                toast('ÿßÿÆÿ™ÿ± ÿµŸàÿ±ÿßŸã ÿ£ŸàŸÑÿßŸã', 'warn');
                return;
            }
            
            state.fileName = document.getElementById('fileName').value || 'output';
            goTo('Processing');
            
            try {
                await buildPDF();
                
                await delay(300);
                showResult();
                
                if (state.autoDownload) {
                    await delay(500);
                    downloadResult();
                }
                
            } catch (err) {
                log(`PDF Error: ${err.message}`, 'error');
                toast(err.message, 'error');
                goTo('Layout');
            }
        }

        async function buildPDF() {
            const { jsPDF } = window.jspdf;
            
            log('Creating PDF...');
            
            // Create with default settings
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4',
                compress: true
            });
            
            const PW = 210, PH = 297, M = 4, P = 2;
            const layout = CONFIG.LAYOUTS[state.layout];
            const cellW = (PW - M * 2) / layout.cols;
            const cellH = (PH - M * 2) / layout.rows;
            const perPage = layout.cols * layout.rows;
            
            // Get selected images sorted
            const images = state.images
                .filter(img => state.selected.has(img.id))
                .sort((a, b) => a.id - b.id);
            
            const total = images.length;
            const totalPages = Math.ceil(total / perPage);
            
            log(`Building: ${total} images, ${totalPages} pages`);
            
            let pageNum = 0;
            let added = 0;
            let errors = 0;
            
            for (let i = 0; i < total; i++) {
                const pos = i % perPage;
                const col = pos % layout.cols;
                const row = Math.floor(pos / layout.cols);
                
                if (pos === 0 && i > 0) doc.addPage();
                if (pos === 0) pageNum++;
                
                const img = images[i];
                const x = M + col * cellW;
                const y = M + row * cellH;
                const maxW = cellW - P * 2;
                const maxH = cellH - P * 2;
                
                try {
                    // CRITICAL: Ensure JPEG format with proper encoding
                    let imgData = img.data;
                    
                    // Always reconvert to ensure proper format
                    imgData = await ensureJPEG(imgData);
                    
                    if (!imgData) {
                        throw new Error('Invalid image');
                    }
                    
                    // Calculate dimensions
                    const ratio = (img.w || 100) / (img.h || 100);
                    const cellRatio = maxW / maxH;
                    let drawW, drawH;
                    
                    if (ratio > cellRatio) {
                        drawW = maxW;
                        drawH = maxW / ratio;
                    } else {
                        drawH = maxH;
                        drawW = maxH * ratio;
                    }
                    
                    const drawX = x + P + (maxW - drawW) / 2;
                    const drawY = y + P + (maxH - drawH) / 2;
                    
                    // Draw border
                    doc.setDrawColor(230);
                    doc.setLineWidth(0.1);
                    doc.rect(x + P, y + P, maxW, maxH);
                    
                    // Add image - use explicit JPEG format
                    doc.addImage(
                        imgData,
                        'JPEG',
                        drawX,
                        drawY,
                        drawW,
                        drawH,
                        undefined, // alias
                        'FAST' // compression
                    );
                    
                    added++;
                    
                } catch (e) {
                    errors++;
                    log(`Image ${i} failed: ${e.message}`, 'error');
                    
                    // Draw placeholder
                    doc.setFillColor(250);
                    doc.rect(x + P, y + P, maxW, maxH, 'F');
                }
                
                // Update progress
                const pct = ((i + 1) / total) * 100;
                updateProgress(pct, pageNum, totalPages);
                document.getElementById('procImages').textContent = added;
                document.getElementById('procPages').textContent = pageNum;
                document.getElementById('procErrors').textContent = errors;
                
                // Yield
                if (i % 2 === 0) await delay(5);
            }
            
            if (added === 0) {
                throw new Error('ŸÑŸÖ ÿ™ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿä ÿµŸàÿ±');
            }
            
            log(`Done! ${added}/${total} images, ${errors} errors`);
            
            // Generate blob
            state.pdfBlob = doc.output('blob');
            state.pdfStats = { images: added, pages: pageNum, size: state.pdfBlob.size };
            
            updateProgress(100, pageNum, totalPages);
        }

        // CRITICAL FUNCTION: Ensure proper JPEG encoding
        async function ensureJPEG(dataUrl) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        // Use smaller size for reliability
                        const maxSize = 400;
                        let w = img.width;
                        let h = img.height;
                        
                        if (w > maxSize || h > maxSize) {
                            const ratio = Math.min(maxSize / w, maxSize / h);
                            w = Math.round(w * ratio);
                            h = Math.round(h * ratio);
                        }
                        
                        canvas.width = w;
                        canvas.height = h;
                        const ctx = canvas.getContext('2d');
                        
                        // White background
                        ctx.fillStyle = '#FFFFFF';
                        ctx.fillRect(0, 0, w, h);
                        ctx.drawImage(img, 0, 0, w, h);
                        
                        // Get JPEG with medium quality
                        const result = canvas.toDataURL('image/jpeg', 0.6);
                        canvas.width = canvas.height = 0;
                        
                        resolve(result);
                    } catch (e) {
                        reject(e);
                    }
                };
                img.onerror = () => reject(new Error('Failed to load image'));
                img.src = dataUrl;
            });
        }

        function updateProgress(pct, page, total) {
            const circle = document.getElementById('progressCircle');
            const offset = 565.48 - (pct / 100) * 565.48;
            circle.style.strokeDashoffset = offset;
            document.getElementById('progressPercent').textContent = `${Math.round(pct)}%`;
            document.getElementById('progressLabel').textContent = `ÿµŸÅÿ≠ÿ© ${page}/${total}`;
        }

        // ============================================================
        // RESULT
        // ============================================================
        function showResult() {
            goTo('Result');
            
            document.getElementById('resImages').textContent = state.pdfStats?.images || state.selected.size;
            document.getElementById('resPages').textContent = state.pdfStats?.pages || 0;
            document.getElementById('resSize').textContent = ((state.pdfStats?.size || 0) / 1024 / 1024).toFixed(1);
            
            // Confetti!
            createConfetti();
        }

        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#00f2fe', '#43e97b', '#f472b6'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = 2 + Math.random() * 2 + 's';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 5000);
            }
        }

        // ============================================================
        // DOWNLOAD & SHARE - FIXED FOR WEBVIEW
        // ============================================================
        function downloadResult() {
            if (!state.pdfBlob) {
                toast('ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖŸÑŸÅ', 'error');
                return;
            }
            
            const filename = state.fileName + '.pdf';
            log(`Downloading: ${filename}`);
            
            try {
                const url = URL.createObjectURL(state.pdfBlob);
                
                // Method 1: Create link
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.style.position = 'fixed';
                link.style.left = '-9999px';
                document.body.appendChild(link);
                
                // For iOS - open in new tab
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    window.open(url, '_blank');
                    toast('ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸÑŸÅ', 'success');
                } else {
                    link.click();
                    toast('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...', 'success');
                }
                
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 1000);
                
            } catch (e) {
                log(`Download error: ${e.message}`, 'error');
                previewResult(); // Fallback
            }
        }

        async function shareResult() {
            if (!state.pdfBlob) return;
            
            try {
                const file = new File([state.pdfBlob], state.fileName + '.pdf', { type: 'application/pdf' });
                
                if (navigator.share && navigator.canShare?.({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: state.fileName
                    });
                    toast('ÿ™ŸÖÿ™ ÿßŸÑŸÖÿ¥ÿßÿ±ŸÉÿ©', 'success');
                } else {
                    downloadResult();
                }
            } catch (e) {
                if (e.name !== 'AbortError') downloadResult();
            }
        }

        function previewResult() {
            if (!state.pdfBlob) return;
            
            try {
                const url = URL.createObjectURL(state.pdfBlob);
                window.open(url, '_blank');
                toast('ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿπÿßŸäŸÜÿ©', 'success');
            } catch (e) {
                toast('ÿÆÿ∑ÿ£', 'error');
            }
        }

        function startOver() {
            // Cleanup
            state.images.forEach(img => img.data = null);
            resetState();
            goTo('Welcome');
        }

        // ============================================================
        // UTILITIES
        // ============================================================
        function formatSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / 1024 / 1024).toFixed(1) + ' MB';
        }

        function fileToDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function delay(ms) {
            return new Promise(r => setTimeout(r, ms));
        }

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').style.display = 'flex';
            showLoadingBar(false);
        }

        function updateLoading(text) {
            document.getElementById('loadingText').textContent = text;
        }

        function showLoadingBar(show) {
            document.getElementById('loadingBar').style.display = show ? 'block' : 'none';
        }

        function updateLoadingBar(pct) {
            document.getElementById('loadingProgress').style.width = pct + '%';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function toast(msg, type = 'info') {
            const snackbar = document.getElementById('snackbar');
            const icons = { info: 'info', success: 'check_circle', error: 'error', warn: 'warning' };
            const colors = { info: '#4facfe', success: '#43e97b', error: '#f5576c', warn: '#f59e0b' };
            
            document.getElementById('snackbarIcon').textContent = icons[type];
            document.getElementById('snackbarIcon').style.color = colors[type];
            document.getElementById('snackbarText').textContent = msg;
            
            snackbar.classList.add('show');
            setTimeout(() => snackbar.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
